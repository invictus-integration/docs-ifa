"use strict";(self.webpackChunkinvictus_integration=self.webpackChunkinvictus_integration||[]).push([[4588],{5647:(e,i,s)=>{s.r(i),s.d(i,{assets:()=>l,contentTitle:()=>o,default:()=>c,frontMatter:()=>r,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"dashboard/installation/dashboard-migration","title":"Invictus Dashboard V2 Migration Guide","description":"Below is some useful information for when users are upgrading their Invictus installation from V1 to V2. To update your build and release pipelines, please refer to the build pipeline and release pipeline guides.","source":"@site/versioned_docs/version-v6.0.0/dashboard/installation/dashboard-migration.md","sourceDirName":"dashboard/installation","slug":"/dashboard/installation/dashboard-migration","permalink":"/docs-ifa/dashboard/installation/dashboard-migration","draft":false,"unlisted":false,"editUrl":"https://github.com/invictus-integration/docs-ifa/edit/master/docs/versioned_docs/version-v6.0.0/dashboard/installation/dashboard-migration.md","tags":[],"version":"v6.0.0","frontMatter":{"sidebar_class_name":"hidden"},"sidebar":"sidebar","previous":{"title":"Add Invictus Dashboard to release package","permalink":"/docs-ifa/dashboard/installation/dashboard-buildpipeline"},"next":{"title":"Dashboard Release Pipeline","permalink":"/docs-ifa/dashboard/installation/dashboard-releasepipeline"}}');var n=s(4848),t=s(8453);const r={sidebar_class_name:"hidden"},o="Invictus Dashboard V2 Migration Guide",l={},d=[{value:"Build pipeline",id:"build-pipeline",level:2},{value:"Release pipeline",id:"release-pipeline",level:2},{value:"Object ID Update",id:"object-id-update",level:2},{value:"Remove Existing Role Assignments",id:"remove-existing-role-assignments",level:2},{value:"Azure AD Setup",id:"azure-ad-setup",level:2},{value:"SQL Data Migration",id:"sql-data-migration",level:2},{value:"Data Migration Release Pipeline Changes",id:"data-migration-release-pipeline-changes",level:3},{value:"Dashboard URL",id:"dashboard-url",level:2},{value:"Add Role Assignments",id:"add-role-assignments",level:2},{value:"Common Issues When Migrating",id:"common-issues-when-migrating",level:2},{value:"Invictus Configure Dashboard Script Update",id:"invictus-configure-dashboard-script-update",level:2}];function h(e){const i={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.header,{children:(0,n.jsx)(i.h1,{id:"invictus-dashboard-v2-migration-guide",children:"Invictus Dashboard V2 Migration Guide"})}),"\n",(0,n.jsxs)(i.p,{children:["Below is some useful information for when users are upgrading their Invictus installation from V1 to V2. To update your build and release pipelines, please refer to the ",(0,n.jsx)(i.a,{href:"/docs-ifa/dashboard/installation/dashboard-buildpipeline",children:"build pipeline"})," and ",(0,n.jsx)(i.a,{href:"/docs-ifa/dashboard/installation/dashboard-releasepipeline",children:"release pipeline"})," guides."]}),"\n",(0,n.jsx)(i.h2,{id:"build-pipeline",children:"Build pipeline"}),"\n",(0,n.jsxs)(i.p,{children:["The Azure Blob Storage container for Dashboard V2 is ",(0,n.jsx)(i.code,{children:"dashboard-v2"}),", so update the ",(0,n.jsx)(i.code,{children:"StorageContainerName"})," parameter you use in the build pipeline."]}),"\n",(0,n.jsx)(i.h2,{id:"release-pipeline",children:"Release pipeline"}),"\n",(0,n.jsx)(i.p,{children:"Make sure that the PowerShell script in the release pipeline which runs Deploy.ps1 has the following parameters:"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{children:"    azurePowerShellVersion: LatestVersion\n    pwsh: false\n"})}),"\n",(0,n.jsx)(i.h2,{id:"object-id-update",children:"Object ID Update"}),"\n",(0,n.jsxs)(i.p,{children:["When upgrading to Invictus V2, the ",(0,n.jsx)(i.code,{children:"devOpsObjectId"})," parameter which is passed to the release pipeline should be updated. This must be changed to the ",(0,n.jsx)(i.strong,{children:"Enterprise Application"})," Object ID of the service principal thats connected to the DevOps service connection (not of the App Registration). This change is required for both Dashboard and Framework pipelines."]}),"\n",(0,n.jsx)(i.h2,{id:"remove-existing-role-assignments",children:"Remove Existing Role Assignments"}),"\n",(0,n.jsx)(i.p,{children:"Invictus V2 includes functionality to automatically deploy role assignments which were previously set manually. However, if these role assignments are already present, they will cause a conflict. In your Invictus resource group, remove any roles which are assigned to the Azure functions. Typically, this is just 1 role assignment:"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:'"Monitoring Contributor" rights for the FlowHandlerJob function for the Invictus resource group.'}),"\n"]}),"\n",(0,n.jsx)(i.h2,{id:"azure-ad-setup",children:"Azure AD Setup"}),"\n",(0,n.jsxs)(i.p,{children:["If your Invictus installation integrates with Azure AD, please follow the ",(0,n.jsx)(i.a,{href:"/docs-ifa/dashboard/installation/give_ad_access",children:"Azure AD setup guide"})," to update your app registration, or set up a new one with the appropriate settings required for Invictus V2."]}),"\n",(0,n.jsx)(i.h2,{id:"sql-data-migration",children:"SQL Data Migration"}),"\n",(0,n.jsxs)(i.p,{children:["Invictus V2 includes functionality to migrate the SQL data from your previous installation into the Cosmos DB of the new version. Data relating to users, groups and the folder and flow structure will be migrated. Flow data will ",(0,n.jsx)(i.strong,{children:"not"})," be migrated."]}),"\n",(0,n.jsx)(i.h3,{id:"data-migration-release-pipeline-changes",children:"Data Migration Release Pipeline Changes"}),"\n",(0,n.jsxs)(i.p,{children:["The data migration process forms part of the release pipeline. Please refer to ",(0,n.jsx)(i.a,{href:"/docs-ifa/dashboard/installation/dashboard-releasepipeline",children:"release pipeline"})," for more information. The deploy script parameter ",(0,n.jsx)(i.code,{children:"PerformSqlDataMigration"})," must be set to ",(0,n.jsx)(i.code,{children:"1"}),". The deploy script also accepts a few optional parameters to be able to connect to your SQL database:"]}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:["-sqlToMigrateServerName : Server name hosting the SQL DB you wish to migrate. Defaults to ",(0,n.jsx)(i.code,{children:"invictus-{ResourcePrefix}-sqlsvr"})]}),"\n",(0,n.jsxs)(i.li,{children:["-sqlToMigrateDBName : Name of the SQL DB you wish to migrate. Defaults to ",(0,n.jsx)(i.code,{children:"coditcip"})]}),"\n",(0,n.jsxs)(i.li,{children:["-sqlToMigrateUserName : The login username used to connect to the SQL Server. Defaults to ",(0,n.jsx)(i.code,{children:"InvictusFrameworkAdmin"})]}),"\n"]}),"\n",(0,n.jsxs)(i.p,{children:["In addition to these values, the SQL server password ",(0,n.jsx)(i.strong,{children:"must"})," be stored as a secret in your Invictus Azure Key Vault with the name ",(0,n.jsx)(i.code,{children:"invictussqlserverpassword"}),"."]}),"\n",(0,n.jsx)(i.p,{children:"Thats it! The data migration will now run as part of your release pipeline. The resultant data in Cosmos DB will be validated against the original SQL data, with the validation results printed in the release logs. However it is still important to manually verify the migrated data. When complete, you will be able to login to the new Invictus V2 Dashboard with the same credentials as before."}),"\n",(0,n.jsxs)(i.p,{children:["Once you are satisfied with the migrated data, it is advised to change the ",(0,n.jsx)(i.code,{children:"PerformSqlDataMigration"})," script parameter to ",(0,n.jsx)(i.code,{children:"0"})," so that the migration process is entirely skipped in subsequent releases."]}),"\n",(0,n.jsx)(i.h2,{id:"dashboard-url",children:"Dashboard URL"}),"\n",(0,n.jsxs)(i.p,{children:["The Invictus V2 release pipeline will create a new App Service Dashboard resource with a -v2 suffix e.g invictus-dev-invictusdashboard-v2. This means that the URL of this resource will be used to access the new Dashboard. If instead you wish to maintain your current URLs for the Dashboard, the old Dashboard App Service resource must be deleted from your resource group. Then, pass ",(0,n.jsx)(i.code,{children:"invictusDashboardWebAppName"})," as a parameter to the release script, passing the name of the app service as a value."]}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.strong,{children:"NOTE: By doing this you will lose access to the old Dashboard and the ability to view and query its historic data."})}),"\n",(0,n.jsx)(i.h2,{id:"add-role-assignments",children:"Add Role Assignments"}),"\n",(0,n.jsxs)(i.p,{children:["In addition to the flowhandlerjob function, in V2 also the dashboardgateway must have Logic App Contribute access on the resource group or subscription which contains the Logic Apps.\nSee also ",(0,n.jsx)(i.a,{href:"/docs-ifa/dashboard/accesscontrolrights",children:"Access Control Rights"})]}),"\n",(0,n.jsx)(i.h2,{id:"common-issues-when-migrating",children:"Common Issues When Migrating"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:["\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.code,{children:"You cannot change the OS hosting your app at this time. Please recreate your app with the desired OS."})}),"\n",(0,n.jsxs)(i.p,{children:["If you are passing the ",(0,n.jsx)(i.code,{children:"servicePlanName"})," or ",(0,n.jsx)(i.code,{children:"autoscaleForPlanName"})," (or both) parameters to the Dashboard release pipeline, these must be updated by adding ",(0,n.jsx)(i.code,{children:"-linux"})," to the end of their values (feel free to maintain your own naming conventions). ",(0,n.jsx)(i.em,{children:"This change is required for the Dashboard pipeline only"}),"."]}),"\n"]}),"\n",(0,n.jsxs)(i.li,{children:["\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.code,{children:"The role assignment already exists"})}),"\n",(0,n.jsx)(i.p,{children:"If you have role assignments conflicts during deployment, you might have multiple role assignments defined at the Invictus resource group. This case, remove all role assignments defined at the Invictus resource group level."}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(i.h2,{id:"invictus-configure-dashboard-script-update",children:"Invictus Configure Dashboard Script Update"}),"\n",(0,n.jsxs)(i.p,{children:["If you are using the PowerShell script Invictus-ConfigureDashboard.ps1 to deploy flows, etc, you must replace this script with the V2 version.\nThis version can be found ",(0,n.jsx)(i.a,{href:"https://github.com/Codit/integration-practice/blob/main/src/invictus/scripts/Invictus-ConfigureDashboard-v2.ps1",children:"here"})]})]})}function c(e={}){const{wrapper:i}={...(0,t.R)(),...e.components};return i?(0,n.jsx)(i,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}},8453:(e,i,s)=>{s.d(i,{R:()=>r,x:()=>o});var a=s(6540);const n={},t=a.createContext(n);function r(e){const i=a.useContext(t);return a.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function o(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:r(e.components),a.createElement(t.Provider,{value:i},e.children)}}}]);