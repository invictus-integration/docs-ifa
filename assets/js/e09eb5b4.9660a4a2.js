"use strict";(self.webpackChunkinvictus_integration=self.webpackChunkinvictus_integration||[]).push([[67],{6021:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/files/invictusVnetDNSZones-5ee79326b5f40a06bc9546b98300fe56.bicep"},6056:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"dashboard/installation/dashboard-vnet","title":"Invictus Dashboard VNET Support","description":"Invictus includes functionality which allows all its resources to run within an Azure Virtual Network (VNET). This document will guide you through this process.","source":"@site/versioned_docs/version-v6.0.0/dashboard/installation/dashboard-vnet.md","sourceDirName":"dashboard/installation","slug":"/dashboard/installation/dashboard-vnet","permalink":"/docs-ifa/dashboard/installation/dashboard-vnet","draft":false,"unlisted":false,"editUrl":"https://github.com/invictus-integration/docs-ifa/edit/master/docs/versioned_docs/version-v6.0.0/dashboard/installation/dashboard-vnet.md","tags":[],"version":"v6.0.0","frontMatter":{"sidebar_class_name":"hidden"},"sidebar":"sidebar","previous":{"title":"Dashboard Release Pipeline","permalink":"/docs-ifa/dashboard/installation/dashboard-releasepipeline"},"next":{"title":"Dashboard Homepage: overview of flow statuses","permalink":"/docs-ifa/dashboard/flows/"}}');var r=s(4848),t=s(8453);const a={sidebar_class_name:"hidden"},o="Invictus Dashboard VNET Support",l={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Role Assignment",id:"role-assignment",level:2},{value:"Release Pipeline Changes",id:"release-pipeline-changes",level:2},{value:"Full Deploy Script Parameters Example",id:"full-deploy-script-parameters-example",level:3}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"invictus-dashboard-vnet-support",children:"Invictus Dashboard VNET Support"})}),"\n",(0,r.jsx)(n.p,{children:"Invictus includes functionality which allows all its resources to run within an Azure Virtual Network (VNET). This document will guide you through this process."}),"\n",(0,r.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"An Azure Virtual Network"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Including two subnets, one each for:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Private Endpoints"}),"\n",(0,r.jsx)(n.li,{children:"Container App Environment"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["The subnets must have the following services enabled","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Microsoft.AzureCosmosDB"}),"\n",(0,r.jsx)(n.li,{children:"Microsoft.EventHub"}),"\n",(0,r.jsx)(n.li,{children:"Microsoft.KeyVault"}),"\n",(0,r.jsx)(n.li,{children:"Microsoft.ServiceBus"}),"\n",(0,r.jsx)(n.li,{children:"Microsoft.Storage"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["The container app subnet must also have the delegation ",(0,r.jsx)(n.code,{children:"Microsoft.App/environments"})," (",(0,r.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/virtual-network/manage-subnet-delegation",children:"more info"}),")"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"10 Private DNS Zones"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"privatelink.azurecr.io"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"privatelink.blob.core.windows.net"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"privatelink.file.core.windows.net"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"privatelink.mongo.cosmos.azure.com"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"privatelink.queue.core.windows.net"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"privatelink.servicebus.windows.net"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"privatelink.table.core.windows.net"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"privatelink.table.cosmos.azure.com"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"privatelink.vaultcore.azure.net"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"privatelink.{regionName}.azurecontainerapps.io"})}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["A Bicep template for these DNS Zones can be found ",(0,r.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:s(6021).A+"",children:"here"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"To be able to deploy the app code from an Azure DevOps pipeline you will need:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["A self hosted agent running on the same VNET with the following software installed:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Powershell"}),"\n",(0,r.jsx)(n.li,{children:"Azure Powershell"}),"\n",(0,r.jsx)(n.li,{children:"Bicep CLI"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"role-assignment",children:"Role Assignment"}),"\n",(0,r.jsxs)(n.p,{children:["If the Invictus resources and the VNET are on different resource groups, then the Invictus resource group will need to be assigned the role of ",(0,r.jsx)(n.code,{children:"Network Contributor"})," onto the VNET resource group."]}),"\n",(0,r.jsx)(n.h2,{id:"release-pipeline-changes",children:"Release Pipeline Changes"}),"\n",(0,r.jsxs)(n.p,{children:["The release pipeline remains the same as explained ",(0,r.jsx)(n.a,{href:"/docs-ifa/dashboard/installation/dashboard-releasepipeline",children:"here"}),", but with a set of VNET specific parameters. The ",(0,r.jsx)(n.code,{children:"enableVnetSupport"})," parameter must be set to ",(0,r.jsx)(n.code,{children:"$true"})," to enable the functionality. The name of the resource group containing the VNET, as well as the VNET name itself must be passed to the ",(0,r.jsx)(n.code,{children:"vnetResourceGroupName"})," and ",(0,r.jsx)(n.code,{children:"vnetName"})," parameters. An array containing the names of the desired subnets must be passed to the ",(0,r.jsx)(n.code,{children:"keyVaultSubnets"}),", ",(0,r.jsx)(n.code,{children:"storageAccountSubnets"}),", ",(0,r.jsx)(n.code,{children:"serviceBusSubnets"}),", ",(0,r.jsx)(n.code,{children:"cosmosDbSubnets"}),", ",(0,r.jsx)(n.code,{children:"eventHubSubnets"})," parameters. You will also need to pass the subnet names to connect the Container App Environment and private endpoints. These parameters are ",(0,r.jsx)(n.code,{children:"containerAppEnvironmentSubnetName"}),", ",(0,r.jsx)(n.code,{children:"privateEndpointSubnetName"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["A full list of VNET parameters can be found ",(0,r.jsx)(n.a,{href:"/docs-ifa/dashboard/installation/dashboard-releasepipeline",children:"here"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"full-deploy-script-parameters-example",children:"Full Deploy Script Parameters Example"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-powershell",children:'PS> $(ArtifactsPath)/Deploy.ps1 `\n-artifactsPath "$(ArtifactsPath)" `\n-artifactsPathScripts "$(ArtifactsPathScripts)" `\n-resourcePrefix "$(Infra.Environment.ResourcePrefix)" `\n-resourceGroupName "$(Infra.Environment.ResourceGroup)" `\n-variableGroupName "Software.Infra.$(Infra.Environment.ShortName)" `\n-resourceGroupLocation "$(Infra.Environment.Region.Primary)" `\n-devOpsObjectId $(Infra.DevOps.Object.Id) `\n-azureActiveDirectoryClientId "********-****-****-****-********" `\n-azureActiveDirectoryTenantId "********-****-****-****-********" `\n-use32BitWorkerProcess $false `\n-azureActiveDirectoryClientSecret "*************************" `\n-azureActiveDirectoryAudience "api://********-****-****-****-********" `\n-performSqlDataMigration 0 `\n-enableVnetSupport $true `\n-vnetName "invictus-vnet" `\n-vnetResourceGroupName "invictus-vnet" `\n-keyVaultSubnets @("snet-privateendpoints", "snet-cae") `\n-storageAccountSubnets @("snet-privateendpoints", "snet-cae") `\n-serviceBusSubnets @("snet-privateendpoints", "snet-cae") `\n-cosmosDbSubnets @("snet-privateendpoints", "snet-cae") `\n-eventHubSubnets @("snet-privateendpoints", "snet-cae") `\n-containerAppEnvironmentSubnetName "snet-cae" `\n-privateEndpointSubnetName "snet-privateendpoints"\n'})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>o});var i=s(6540);const r={},t=i.createContext(r);function a(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);