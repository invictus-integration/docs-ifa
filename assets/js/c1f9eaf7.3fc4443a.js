"use strict";(globalThis.webpackChunkinvictus_integration=globalThis.webpackChunkinvictus_integration||[]).push([[9367],{1065:(e,n,r)=>{r.d(n,{Ay:()=>l,mw:()=>c,pn:()=>s});var t=r(6540),i=r(4848);function s({title:e,children:n}){return null}function c(){const[e,n]=(0,t.useState)(!1);return(0,i.jsxs)("span",{style:{position:"relative",display:"inline-block",marginLeft:"8px",textTransform:"none",fontWeight:"bold"},onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1),children:[(0,i.jsx)("span",{style:{backgroundColor:"#e0f7f7",color:"#0b6369",padding:"2px 6px",borderRadius:"4px",fontSize:"0.75rem",fontWeight:"600",fontFamily:"Bitter",cursor:"default",userSelect:"none"},children:"Shared"}),e&&(0,i.jsxs)("span",{style:{position:"absolute",bottom:"125%",left:"50%",transform:"translateX(-50%)",backgroundColor:"#333",color:"#fff",padding:"6px",borderRadius:"6px",whiteSpace:"nowrap",fontSize:"0.75rem",fontFamily:"Bitter",fontWeight:"normal",zIndex:10,pointerEvents:"none"},children:["This section is the same for both Dashboard and Framework. Can be skipped if done already.",(0,i.jsx)("span",{style:{position:"absolute",top:"100%",left:"50%",marginLeft:"-5px",width:0,height:0,borderLeft:"5px solid transparent",borderRight:"5px solid transparent",borderTop:"5px solid #333"}})]})]})}function l({children:e}){const n=t.Children.map(e,e=>e.type===s?{title:e.props.title,content:e.props.children}:null).filter(Boolean),[r,c]=(0,t.useState)(0);return(0,i.jsxs)("div",{style:{maxWidth:"900px",margin:"0"},children:[(0,i.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",marginBottom:"2rem",flexWrap:"wrap"},children:n.map((e,t)=>(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,i.jsx)("div",{onClick:()=>c(t),style:{width:"36px",height:"36px",borderRadius:"50%",backgroundColor:t===r||t<r?"rgb(33, 92, 102)":"#e0e0e0",color:t<=r?"#fff":"#000",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",cursor:"pointer"},title:e.title,children:t<r?"\u2713":t+1}),(0,i.jsx)("div",{onClick:()=>c(t),style:{marginLeft:"0.5rem",marginRight:"0.5rem",textAlign:"left",fontSize:"0.9rem",fontWeight:t===r?"bold":"normal",color:t===r?"rgb(33, 92, 102)":"#666",cursor:"pointer"},children:e.title}),t<n.length-1&&(0,i.jsx)("div",{style:{width:"40px",height:"2px",backgroundColor:t<r?"rgb(33, 92, 102)":"#ccc",margin:"0 0.5rem"}})]},t))}),(0,i.jsx)("div",{children:n[r].content})]})}},2049:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/files/Invictus-RemoveOldRevisions-9db10d3ab82759e4553432e01652f09e.ps1"},4225:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/files/invictusVnetDNSZones-5ee79326b5f40a06bc9546b98300fe56.bicep"},5679:(e,n,r)=>{r.d(n,{Os:()=>o,P8:()=>a,gD:()=>c,jF:()=>d});var t=r(6540),i=r(4848);const s=(0,t.createContext)(!1);function c({children:e}){const[n,r]=(0,t.useState)(!1);return(0,i.jsx)(s.Provider,{value:{visible:n,setVisible:r},children:e})}function l(){return(0,t.useContext)(s)}function d(){const{visible:e,setVisible:n}=l();return(0,i.jsxs)("label",{className:"toggle-container",style:{cursor:"pointer"},children:[(0,i.jsx)("input",{type:"checkbox",checked:e,className:"toggle-checkbox",onChange:()=>n(!e),style:{marginRight:"0.5rem"}}),(0,i.jsx)("span",{className:"toggle-slider"}),(0,i.jsx)("strong",{children:"Show VNET options"})]})}function o({children:e}){const{visible:n}=l();return n?(0,i.jsx)("div",{className:"vnet",children:e}):null}function a({children:e}){const{visible:n}=l();return n?(0,i.jsx)("tr",{className:"vnet",children:e}):null}},8188:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/files/Invictus-GetSources-ea2dec1cf7740cb8b796e7741a80dda7.ps1"},8448:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>x,frontMatter:()=>d,metadata:()=>t,toc:()=>h});const t=JSON.parse('{"id":"framework/installation/index","title":"Installing Invictus Framework","description":"To access the resources stored on Azure Storage and Azure Container Registry you have to request an SAS-token and ACR Password from coditproducts@codit.eu.","source":"@site/versioned_docs/version-v6.0.0/framework/installation/index.mdx","sourceDirName":"framework/installation","slug":"/framework/installation/","permalink":"/framework/installation/","draft":false,"unlisted":false,"editUrl":"https://github.com/invictus-integration/docs-ifa/edit/master/docs/versioned_docs/version-v6.0.0/framework/installation/index.mdx","tags":[],"version":"v6.0.0","frontMatter":{"hide_table_of_contents":true},"sidebar":"sidebar","previous":{"title":"Framework","permalink":"/framework/"},"next":{"title":"Deprecated Framework components","permalink":"/framework/deprecated/"}}');var i=r(4848),s=r(8453),c=r(5679),l=(r(6540),r(1065));const d={hide_table_of_contents:!0},o="Installing Invictus Framework",a={},h=[{value:"Required deployment",id:"required-deployment",level:3},{value:"Required role assignment",id:"required-role-assignment",level:3},{value:"Migrating older pipelines to v2.4+",id:"migrating-older-pipelines-to-v24",level:2},{value:"Build pipeline",id:"build-pipeline",level:3},{value:"Release pipeline",id:"release-pipeline",level:3},{value:"Save installation script to your repository <SharedNote></SharedNote>",id:"save-installation-script-to-your-repository-",level:2},{value:"Add variables to variable group <SharedNote></SharedNote>",id:"add-variables-to-variable-group-",level:2},{value:"YAML Pipeline",id:"yaml-pipeline",level:2},{value:"Variable groups / deployment environment <SharedNote></SharedNote>",id:"variable-groups--deployment-environment-",level:2},{value:"YAML Pipeline",id:"yaml-pipeline-1",level:2},{value:"Deploy Script Parameters",id:"deploy-script-parameters",level:2},{value:"Mandatory Parameters",id:"mandatory-parameters",level:3},{value:"Optional Parameters",id:"optional-parameters",level:3},{value:"Bicep Template Parameters",id:"bicep-template-parameters",level:2},{value:"Top-level parameters",id:"top-level-parameters",level:3},{value:"Function names",id:"function-names",level:4},{value:"Function deployment",id:"function-deployment",level:4}];function p(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components},{Details:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"installing-invictus-framework",children:"Installing Invictus Framework"})}),"\n",(0,i.jsxs)(l.Ay,{children:[(0,i.jsxs)(l.pn,{title:"Prerequisites",children:[(0,i.jsxs)(n.admonition,{type:"info",children:[(0,i.jsxs)(n.mdxAdmonitionTitle,{children:["obtain access ",(0,i.jsx)(l.mw,{})]}),(0,i.jsxs)(n.p,{children:["To access the resources stored on Azure Storage and Azure Container Registry you have to request an SAS-token and ACR Password from ",(0,i.jsx)(n.a,{href:"mailto:coditproducts@codit.eu",children:"coditproducts@codit.eu"}),"."]})]}),(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{children:(0,i.jsxs)(n.strong,{children:["Include VNET support ",(0,i.jsx)(l.mw,{})]})}),(0,i.jsx)(n.p,{children:"Invictus includes functionality which allows all its resources to run within an Azure Virtual Network (VNET)."}),(0,i.jsx)(n.h3,{id:"required-deployment",children:"Required deployment"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"An Azure Virtual Network"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Including two subnets, one each for:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Private Endpoints"}),"\n",(0,i.jsx)(n.li,{children:"Container App Environment"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["The subnets must have the following services enabled","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"Microsoft.AzureCosmosDB"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"Microsoft.EventHub"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"Microsoft.KeyVault"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"Microsoft.ServiceBus"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"Microsoft.Storage"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["The Container App ",(0,i.jsxs)(n.a,{href:"https://learn.microsoft.com/en-us/azure/virtual-network/manage-subnet-delegation",children:["subnet must also have the delegation ",(0,i.jsx)(n.code,{children:"Microsoft.App/environments"})]})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Private DNS Zones (",(0,i.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:r(4225).A+"",children:"Bicep template"}),")"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"privatelink.azurecr.io"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"privatelink.blob.core.windows.net"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"privatelink.file.core.windows.net"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"privatelink.mongo.cosmos.azure.com"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"privatelink.queue.core.windows.net"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"privatelink.servicebus.windows.net"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"privatelink.table.core.windows.net"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"privatelink.table.cosmos.azure.com"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"privatelink.vaultcore.azure.net"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"privatelink.{regionName}.azurecontainerapps.io"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"To be able to deploy the app code from an Azure DevOps pipeline you will need a self hosted agent running on the same VNET with the following software installed:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Powershell"}),"\n",(0,i.jsx)(n.li,{children:"Azure Powershell"}),"\n",(0,i.jsx)(n.li,{children:"Bicep CLI"}),"\n"]}),"\n"]}),"\n"]}),(0,i.jsx)(n.h3,{id:"required-role-assignment",children:"Required role assignment"}),(0,i.jsxs)(n.p,{children:["If the Invictus resources and the VNET are on different resource groups, then the Invictus resource group will need to be assigned the role of ",(0,i.jsx)(n.code,{children:"Network Contributor"})," onto the VNET resource group."]})]}),(0,i.jsx)(n.hr,{}),(0,i.jsx)(n.h2,{id:"migrating-older-pipelines-to-v24",children:"Migrating older pipelines to v2.4+"}),(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{children:(0,i.jsx)(n.strong,{children:"Migrate to Framework v2.4+"})}),(0,i.jsx)(n.h3,{id:"build-pipeline",children:"Build pipeline"}),(0,i.jsx)(n.p,{children:"Nothing changes for the build pipeline."}),(0,i.jsx)(n.p,{children:"The difference lies in the artifacts that the build produces, everything needed for the release is now included in the build (scripts, resources, etc..), which greatly simplifies the release pipeline."}),(0,i.jsx)(n.h3,{id:"release-pipeline",children:"Release pipeline"}),(0,i.jsxs)(n.p,{children:["The task group is now replaced by a single Azure Powershell task included in the build artifacts. Please refer to the ",(0,i.jsx)(n.strong,{children:"Framework release pipeline"})," installation step for more information."]}),(0,i.jsx)(n.p,{children:"The following task group parameters should be used as the PowerShell's arguments:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["ArtifactsPath: ",(0,i.jsx)(n.code,{children:"-ArtifactsPath"})]}),"\n",(0,i.jsxs)(n.li,{children:["ResourcePrefix: ",(0,i.jsx)(n.code,{children:"-ResourcePrefix"})]}),"\n",(0,i.jsxs)(n.li,{children:["AzureResourceGroup: ",(0,i.jsx)(n.code,{children:"-ResourceGroupName"})]}),"\n",(0,i.jsxs)(n.li,{children:["Location: ",(0,i.jsx)(n.code,{children:"-ResourceGroupLocation"})]}),"\n"]}),(0,i.jsx)(n.p,{children:"The AdditionalTemplateParameters can simply be copied and added to the Script Arguments."}),(0,i.jsx)(n.p,{children:"If you are using the Azure PowerShell task to retrieve the access policies from key vault, then this task should also be removed from the release pipeline as it is now also included in the deployment script."}),(0,i.jsxs)(n.p,{children:["You can copy the ",(0,i.jsx)(n.code,{children:"-keyvaultName"})," argument to the new PowerShell arguments."]})]})]}),(0,i.jsxs)(l.pn,{title:"Build pipeline",children:[(0,i.jsxs)(n.h2,{id:"save-installation-script-to-your-repository-",children:["Save installation script to your repository ",(0,i.jsx)(l.mw,{})]}),(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:r(8188).A+"",children:(0,i.jsx)(n.code,{children:"Invictus-GetSources.ps1"})})," script will pull the latest Invictus resources needed to deploy the Framework."]}),(0,i.jsxs)(n.h2,{id:"add-variables-to-variable-group-",children:["Add variables to variable group ",(0,i.jsx)(l.mw,{})]}),(0,i.jsxs)(n.p,{children:["Secrets are required for authentication. These should be provided to you by ",(0,i.jsx)(n.strong,{children:"Codit Software"}),". Create a variable group for them:"]}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["{prefix}",".Invictus.Installation"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Invictus.Installation.StorageAccount.Name"}),": invictusreleases"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Invictus.Installation.StorageAccount.Dashboard.SasToken"}),": value provided by Codit Software (if you're also deploying the Dashboard)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Invictus.Installation.StorageAccount.Framework.SasToken"}),": value provided by Codit Software"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Infra.Environment.ACRUsername"}),": value provided by Codit Software"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Infra.Environment.ACRPassword"}),": value provided by Codit Software"]}),"\n"]}),"\n"]}),"\n"]}),(0,i.jsx)(n.h2,{id:"yaml-pipeline",children:"YAML Pipeline"}),(0,i.jsx)(n.p,{children:"Next step is to add YAML pipelines to build the Invictus for Azure Framework. Change the following example file according to your needs, for example change the trigger path:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"  paths:\n    include:\n    - /src/customer.azure.invictus\n"})}),(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{children:(0,i.jsx)(n.strong,{children:"Full YAML build pipeline example"})}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"pr: none\ntrigger:\n  branches:\n    include:\n    - main\n    - feature/*\n  paths:\n    include:\n    - /src/customer.azure.invictus\n\nparameters:\n- name: Version\n  displayName: Invictus Version\n  type: string\n  default: '*'\n- name: useBeta\n  displayName: Use Beta\n  type: string\n  default: $False\n\npool:\n  vmImage: 'windows-latest'\n\nstages:\n- stage: Package\n  displayName: Package\n  dependsOn: []\n  variables:\n  - group: prefix.invictus.installation\n  jobs:\n  - job: publish\n    displayName: Build and Publish Framework\n    steps:\n    - checkout: self\n      clean: true\n      persistCredentials: true\n\n    - task: PowerShell@2\n      displayName: 'Pull Invictus sources'\n      inputs:\n        targetType: filePath\n        filePath: './scripts/Invictus-GetSources.ps1'\n        arguments: >\n          -StorageAccountName '$(Invictus.Installation.StorageAccount.Name)'\n          -StorageSasToken '$(Invictus.Installation.StorageAccount.Framework.SasToken)'\n          -StorageContainerName 'framework'\n          -SaveLocation '$(Build.ArtifactStagingDirectory)'\n          -UseBeta ${{ parameters.useBeta }}\n          -Version ${{ parameters.version }}\n              \n    - task: PublishPipelineArtifact@1\n      inputs:\n        TargetPath: $(Build.ArtifactStagingDirectory)\n        ArtifactName: framework\n        publishLocation: 'pipeline'\n"})})]})]}),(0,i.jsxs)(l.pn,{title:"Release pipeline",children:[(0,i.jsx)(n.p,{children:"The release pipeline will use the artifacts created from the build pipeline and publish this to the stage(s) you define. Each stage will deploy the resources to the Azure subscription and resource group you specify in the deployment tasks."}),(0,i.jsx)(n.p,{children:"The release uses variable groups and edits/adds variables."}),(0,i.jsxs)(n.h2,{id:"variable-groups--deployment-environment-",children:["Variable groups / deployment environment ",(0,i.jsx)(l.mw,{})]}),(0,i.jsxs)(n.p,{children:["Create a variable group named ",(0,i.jsxs)(n.strong,{children:["{prefix}",".Invictus.","{stage}"]})," for all the stages (environments) and add at least one variable (eg: ",(0,i.jsx)(n.code,{children:"Invictus.Secrets.ApiKey1.Name = apikey1"}),")."]}),(0,i.jsx)(n.admonition,{title:"permit build service access to variable groups",type:"warning",children:(0,i.jsxs)(n.p,{children:["Make sure the ",(0,i.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/devops/pipelines/process/access-tokens?view=azure-devops&tabs=yaml",children:"Project Collection Build Service"})," has ",(0,i.jsx)(n.strong,{children:"Administrator"})," access to these variable groups (",(0,i.jsx)("u",{children:"Pipelines"})," > ",(0,i.jsx)("u",{children:"Library"})," > ",(0,i.jsx)("u",{children:"Security"}),")"]})}),(0,i.jsx)(n.h2,{id:"yaml-pipeline-1",children:"YAML Pipeline"}),(0,i.jsx)(n.p,{children:"Next step is to add a YAML pipeline to release the Invictus for Azure Framework. Change the following example file according to your needs, for example change the needed environments and change the name of the build pipeline trigger:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"resources:\n  pipelines:\n    # Name of the pipeline resource inside this workflow. Used to reference the pipeline resources later on (e.g. download artifacts).\n  - pipeline: _build\n    # Name of the build pipeline in Azure Pipelines\n    source: 'customer.azure.invictus.framework.build' \n    trigger: true\n"})}),(0,i.jsxs)(n.p,{children:["If you need to overwrite more bicep template parameters make sure to add this to the ",(0,i.jsx)(n.code,{children:"deployScriptParameters"}),". A complete list of bicep template parameters can be found ",(0,i.jsx)(n.a,{href:"#bicep-template-parameters",children:"here"}),"."]}),(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{children:(0,i.jsx)(n.strong,{children:"Full YAML release pipeline example"})}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"pr: none\ntrigger: none\n\nresources:\n  pipelines:\n    # Name of the pipeline resource inside this workflow. Used to reference the pipeline resources later on (e.g. download artifacts).\n  - pipeline: _build\n    # Name of the pipeline in Azure Pipelines\n    source: 'customer.azure.invictus.framework.build' \n    trigger: true\n\nparameters:\n  - name: \"Version\"\n    type: string\n    default: \"latest\"\n  - name: \"UseBeta\"\n    type: string\n    default: \"$false\"\n\npool:\n  vmImage: 'ubuntu-latest'\n\nstages: \n- stage: deploy_dev\n  displayName: 'Deploy to Development'\n  variables:\n  - group: infra.dev\n  - group: prefix.invictus.dev\n  - group: prefix.invictus.installation\n  jobs:\n  - deployment: deploy_development\n    displayName: 'Deploy to Development'\n    environment: Development\n    strategy:\n      runOnce:\n        deploy:\n          steps:\n          - download: '_build'\n            displayName: Download Artifact\n          - task: AzureCLI@2\n            env:\n              SYSTEM_ACCESSTOKEN: $(System.AccessToken)\n            inputs:\n              azureSubscription: 'NameOfYourServiceConnection'\n              scriptType: 'pscore'\n              scriptLocation: 'scriptPath'\n              ScriptPath: '$(Pipeline.Workspace)/_build/framework/Deploy.ps1'\n              ScriptArguments: '-version ${{parameters.Version}} -location \"West Europe\" -useBeta ${{parameters.UseBeta}} -acrPath \"invictusreleases.azurecr.io\" -acrUsername $(Infra.Environment.ACRUsername) -acrPassword $(Infra.Environment.ACRPassword) -resourcePrefix $(Infra.Environment.ResourcePrefix) -artifactsPath $(Pipeline.Workspace)/_build/framework -resourceGroupName $(Infra.Environment.ResourceGroup) -variableGroupName invictus.$(Infra.Environment.ShortName) -devOpsObjectId \"$(Infra.DevOps.Object.Id)\" -identityProviderApplicationId \"$(Infra.AzAD.Client.IdentityProviderApplicationId)\"  -identityProviderClientSecret \"$(Infra.AzAD.Client.IdentityProviderClientSecret)\" -containerAppsEnvironmentLocation \"$(Infra.Environment.ContainerAppsEnvironmentLocation)\"'\n\n- stage: deploy_tst\n  displayName: 'Deploy to Test'\n  dependsOn: deploy_dev\n  variables:\n  - group: infra.tst\n  - group: prefix.invictus.tst\n  - group: prefix.invictus.installation\n  jobs:\n  - deployment: deploy_tst\n    displayName: 'Deploy to Test'\n    environment: Test\n    strategy:\n      runOnce:\n        deploy:\n          steps:\n          - download: '_build'\n            displayName: Download Artifact\n          - task: AzureCLI@2\n            env:\n              SYSTEM_ACCESSTOKEN: $(System.AccessToken)\n            inputs:\n              azureSubscription: 'NameOfYourServiceConnection'\n              scriptType: 'pscore'\n              scriptLocation: 'scriptPath'\n              ScriptPath: '$(Pipeline.Workspace)/_build/framework/Deploy.ps1'\n              ScriptArguments: '-version ${{parameters.Version}} -location \"West Europe\" -useBeta ${{parameters.UseBeta}} -acrPath \"invictusreleases.azurecr.io\" -acrUsername $(Infra.Environment.ACRUsername) -acrPassword $(Infra.Environment.ACRPassword) -resourcePrefix $(Infra.Environment.ResourcePrefix) -artifactsPath $(Pipeline.Workspace)/_build/framework -resourceGroupName $(Infra.Environment.ResourceGroup) -variableGroupName invictus.$(Infra.Environment.ShortName) -devOpsObjectId \"$(Infra.DevOps.Object.Id)\" -identityProviderApplicationId \"$(Infra.AzAD.Client.IdentityProviderApplicationId)\"  -identityProviderClientSecret \"$(Infra.AzAD.Client.IdentityProviderClientSecret)\" -containerAppsEnvironmentLocation \"$(Infra.Environment.ContainerAppsEnvironmentLocation)\"'\n\n- stage: deploy_acc\n  displayName: 'Deploy to Acceptance'\n  dependsOn: deploy_tst\n  variables:\n  - group: infra.acc\n  - group: prefix.invictus.acc\n  - group: prefix.invictus.installation\n  jobs:\n  - deployment: deploy_acc\n    displayName: 'Deploy to Acceptance'\n    environment: Acceptance\n    strategy:\n      runOnce:\n        deploy:\n          steps:\n          - download: '_build'\n            displayName: Download Artifact\n          - task: AzureCLI@2\n            env:\n              SYSTEM_ACCESSTOKEN: $(System.AccessToken)\n            inputs:\n              azureSubscription: 'NameOfYourServiceConnection'\n              scriptType: 'pscore'\n              scriptLocation: 'scriptPath'\n              ScriptPath: '$(Pipeline.Workspace)/_build/framework/Deploy.ps1'\n              ScriptArguments: '-version ${{parameters.Version}} -location \"West Europe\" -useBeta ${{parameters.UseBeta}} -acrPath \"invictusreleases.azurecr.io\" -acrUsername $(Infra.Environment.ACRUsername) -acrPassword $(Infra.Environment.ACRPassword) -resourcePrefix $(Infra.Environment.ResourcePrefix) -artifactsPath $(Pipeline.Workspace)/_build/framework -resourceGroupName $(Infra.Environment.ResourceGroup) -variableGroupName invictus.$(Infra.Environment.ShortName) -devOpsObjectId \"$(Infra.DevOps.Object.Id)\" -identityProviderApplicationId \"$(Infra.AzAD.Client.IdentityProviderApplicationId)\"  -identityProviderClientSecret \"$(Infra.AzAD.Client.IdentityProviderClientSecret)\" -containerAppsEnvironmentLocation \"$(Infra.Environment.ContainerAppsEnvironmentLocation)\"'\n\n- stage: deploy_prd\n  displayName: 'Deploy to Production'\n  dependsOn: deploy_acc\n  variables:\n  - group: infra.prd\n  - group: prefix.invictus.prd\n  - group: prefix.invictus.installation\n  jobs:\n  - deployment: deploy_prd\n    displayName: 'Deploy to Production'\n    environment: Production\n    strategy:\n      runOnce:\n        deploy:\n          steps:\n          - download: '_build'\n            displayName: Download Artifact\n          - task: AzureCLI@2\n            env:\n              SYSTEM_ACCESSTOKEN: $(System.AccessToken)\n            inputs:\n              azureSubscription: 'NameOfYourServiceConnection'\n              scriptType: 'pscore'\n              scriptLocation: 'scriptPath'\n              ScriptPath: '$(Pipeline.Workspace)/_build/framework/Deploy.ps1'\n              ScriptArguments: '-version ${{parameters.Version}} -location \"West Europe\" -useBeta ${{parameters.UseBeta}} -acrPath \"invictusreleases.azurecr.io\" -acrUsername $(Infra.Environment.ACRUsername) -acrPassword $(Infra.Environment.ACRPassword) -resourcePrefix $(Infra.Environment.ResourcePrefix) -artifactsPath $(Pipeline.Workspace)/_build/framework -resourceGroupName $(Infra.Environment.ResourceGroup) -variableGroupName invictus.$(Infra.Environment.ShortName) -devOpsObjectId \"$(Infra.DevOps.Object.Id)\" -identityProviderApplicationId \"$(Infra.AzAD.Client.IdentityProviderApplicationId)\"  -identityProviderClientSecret \"$(Infra.AzAD.Client.IdentityProviderClientSecret)\" -containerAppsEnvironmentLocation \"$(Infra.Environment.ContainerAppsEnvironmentLocation)\"'\n"})})]}),(0,i.jsx)(n.h2,{id:"deploy-script-parameters",children:"Deploy Script Parameters"}),(0,i.jsx)(n.p,{children:"The following script parameters are used in the deploy script:"}),(0,i.jsx)(n.h3,{id:"mandatory-parameters",children:"Mandatory Parameters"}),(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Argument name"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"artifactsPath"})}),(0,i.jsxs)(n.td,{children:["Path on the DevOps agent where the downloaded Invictus artifacts are stored (",(0,i.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/devops/pipelines/artifacts/build-artifacts?view=azure-devops&tabs=yaml",children:"publish and download build artifacts"}),")"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"devOpsObjectId"})}),(0,i.jsxs)(n.td,{children:["Object ID of the service principal that's connected to the DevOps service connection, which will get the necessary role definitions to interact with Invictus' deployed resources (i.e. Key vault, Container registry) (",(0,i.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/devops/pipelines/tasks/reference/azure-cli-v2?view=azure-pipelines",children:"Azure CLI task"}),")"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"resourcePrefix"})}),(0,i.jsxs)(n.td,{children:["Prefix used for deployed Azure resources (i.e. ",(0,i.jsx)(n.code,{children:"invictus-{prefix}-vlt"}),")"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"resourceGroupName"})}),(0,i.jsx)(n.td,{children:"Name of Azure resource group where Invictus should be deployed"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"variableGroupName"})}),(0,i.jsx)(n.td,{children:"DevOps variable group to write the Bicep outputs to (i.e. Invictus_CosmosDb_DbName)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"identityProviderApplicationId"})}),(0,i.jsxs)(n.td,{children:["See ",(0,i.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/app-service/configure-authentication-provider-aad",children:"Container App authentication"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"identityProviderClientSecret"})}),(0,i.jsxs)(n.td,{children:["See ",(0,i.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/app-service/configure-authentication-provider-aad",children:"Container App authentication"})]})]})]})]}),(0,i.jsx)(n.h3,{id:"optional-parameters",children:"Optional Parameters"}),(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Argument name"}),(0,i.jsx)(n.th,{children:"Default value"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"resourceGroupLocation"})}),(0,i.jsx)(n.td,{children:"'West Europe'"}),(0,i.jsx)(n.td,{children:"Azure location where resources should be deployed"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"additionalTemplateParameters"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"[]"})}),(0,i.jsx)(n.td,{children:"Additional named parameters for the Bicep template you wish to override. More on this below."})]})]})]}),(0,i.jsxs)(n.admonition,{type:"info",children:[(0,i.jsx)(n.mdxAdmonitionTitle,{children:(0,i.jsx)(n.a,{href:"#bicep-template-parameters",children:"override bicep parameters"})}),(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"AdditionalTemplateParameters"})," can be used to override the default values used by the Bicep template. You simply name the argument as the parameter. For example if you want to use a different servicePlanSku you would add ",(0,i.jsx)(n.code,{children:'-eventHubSkuName "Standard"'})," to the parameters of the PowerShell script."]})]}),(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{children:"Full YAML task example"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"- task: AzureCLI@2\n  displayName: 'Azure CLI'\n  env:\n    SYSTEM_ACCESSTOKEN: $(System.AccessToken)\n  inputs:\n    azureSubscription: '[YOUR_SERVICE_CONNECTION]'\n    addSpnToEnvironment: true\n    scriptType: 'pscore'\n    scriptLocation: 'inlineScript'\n    inlineScript: |\n\n      # Determine where the the provided Invictus 'Deploy.ps1' script is located\n      $artifactsPath = ${{ variables['Pipeline.Workspace'] }} + '/_build/framework' \n      $scriptPath = $artifactsPath + '/Deploy.ps1'\n\n      # Use your service connection's service principal Object ID\n      $objectId = (az ad sp show --id $env:servicePrincipalId | ConvertFrom-Json).id\n\n      & $scriptPath `\n        -artifactsPath $artifactsPath `\n        -version ${{parameters.Version}} `\n        -useBeta false `\n        -acrPath \"invictusreleases.azurecr.io\" `\n        -acrUsername 'admin' `\n        -acrPassword '<pass>' `\n        -resourcePrefix 'dev' `\n        -resourceGroupName 'my-client-dev-rg' `\n        -variableGroupName 'My.Client.Dev' `\n        -devOpsObjectId $objectId `\n        -identityProviderApplicationId '4b559bfb-871a-4013-bce9-829e3aeb6bdd' `\n        -identityProviderClientSecret '<pass>' `\n"})})]}),(0,i.jsx)(n.h2,{id:"bicep-template-parameters",children:"Bicep Template Parameters"}),(0,i.jsx)(n.p,{children:"The below tables lists the parameters accepted by the Bicep template."}),(0,i.jsxs)(c.gD,{children:[(0,i.jsx)(c.jF,{}),(0,i.jsx)("br",{}),(0,i.jsx)("br",{}),(0,i.jsx)(n.h3,{id:"top-level-parameters",children:"Top-level parameters"}),(0,i.jsx)(n.p,{children:"Resource-independent parameters that affect all resources in the deployed resource group."}),(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{style:{textAlign:"center"},children:"Required"}),(0,i.jsx)(n.th,{children:"Default"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"resourcePrefix"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"Yes"}),(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:"Used as part of the default names for most resources."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"devOpsObjectId"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"Yes"}),(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:"The object-id associated with the service principal of the enterprise application that's connected to the service connection on DevOps"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"containerAppsEnvironmentLocation"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"No"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"resourceGroup().location"})}),(0,i.jsx)(n.td,{children:"Location of the ACA environment and Container Apps."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"containerAppsEnvironmentName"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"No"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"invictus-${resourcePrefix}-cae"})}),(0,i.jsxs)(n.td,{children:["The name of the ",(0,i.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/container-apps/environment",children:"Container App environment"}),"."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"invictusUserManagedIdentityName"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"No"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"invictus-user-managed-identity"})}),(0,i.jsx)(n.td,{children:"The name of the Azure user managed identity that has access to all the deployed Invictus Container App components."})]})]})]}),(0,i.jsx)(c.Os,{children:(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"VNET Parameter"}),(0,i.jsx)(n.th,{style:{textAlign:"center"},children:"Required"}),(0,i.jsx)(n.th,{children:"Default"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"enabledVnetSupport"})})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"Yes"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"false"})}),(0,i.jsx)(n.td,{children:"Used to toggle VNET functionality on or off"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"vnetResourceGroupName"})})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"Yes"}),(0,i.jsx)(n.td,{children:"\xa0"}),(0,i.jsx)(n.td,{children:"The name of the resource group on Azure where the VNET is located"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"vnetName"})})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"Yes"}),(0,i.jsx)(n.td,{children:"\xa0"}),(0,i.jsx)(n.td,{children:"The name of the VNET resource"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"privateEndpointSubnetName"})})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"Yes"}),(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:"The name of the subnet to be used to connect the private endpoint resources"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"containerAppEnvironmentSubnetName"})})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"Yes"}),(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:"The name of the subnet to be used to connect the Container App environment"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"dnsZoneSubscriptionId"})})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"No"}),(0,i.jsx)(n.td,{children:"Subscription ID of scope"}),(0,i.jsx)(n.td,{children:"The subscription ID of the private DNS zones."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"dnsZoneResourceGroupName"})})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"No"}),(0,i.jsx)(n.td,{children:"VNET RG name"}),(0,i.jsx)(n.td,{children:"The resource group name of where the private DNS zones are located."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"caeVnetInfraRgName"})})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"No"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"invictus-${resourcePrefix}-cae-infra"})}),(0,i.jsx)(n.td,{children:"The name of the Container App infrastructure resource group (when VNET is activated)."})]})]})]})}),(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{children:"App service parameters"}),(0,i.jsx)(n.p,{children:"Parameters related to the Azure Functions applications that are deployed."}),(0,i.jsx)(n.h4,{id:"function-names",children:"Function names"}),(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{style:{textAlign:"center"},children:"Required"}),(0,i.jsx)(n.th,{children:"Default"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"timesequencerFunctionName"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"No"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"invictus-{resourcePrefix}-timesequencer"})}),(0,i.jsx)(n.td,{children:"Name for the time sequencer function"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"sequenceControllerFunctionName"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"No"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"invictus-{resourcePrefix}-sequencecontroller"})}),(0,i.jsx)(n.td,{children:"Name for the Sequence Controller function"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"xmlJsonConverterFunctionName"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"No"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"invictus-{resourcePrefix}-xmljsonconverter"})}),(0,i.jsx)(n.td,{children:"Name for the XmlJson Converter function"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"xsdValidatorFunctionName"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"No"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"invictus-{resourcePrefix}-xsdvalidator"})}),(0,i.jsx)(n.td,{children:"Name for the XSD Validator function"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"regexTranslatorFunctionName"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"No"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"invictus-{resourcePrefix}-regextranslator"})}),(0,i.jsx)(n.td,{children:"Name for the Regex Translator function"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"transcoV2FunctionName"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"No"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"invictus-{resourcePrefix}-transco-v2"})}),(0,i.jsx)(n.td,{children:"Name for the TranscoV2 function"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"pubsubV2FunctionName"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"No"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"invictus-{resourcePrefix}-pubsub-v2"})}),(0,i.jsx)(n.td,{children:"Name for the PubSubV2 function"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"exceptionHandlerFunctionName"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"No"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"invictus-{resourcePrefix}-exceptionhandler"})}),(0,i.jsx)(n.td,{children:"Name for the Exception Handler function"})]})]})]}),(0,i.jsx)(n.h4,{id:"function-deployment",children:"Function deployment"}),(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{style:{textAlign:"center"},children:"Required"}),(0,i.jsx)(n.th,{children:"Default"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"servicePlanName"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"No"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"invictus-{resourcePrefix}-appplan"})}),(0,i.jsx)(n.td,{children:"Name for the service plan which will host the APIs"})]})})]})]}),(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{children:"Storage parameters"}),(0,i.jsx)(n.p,{children:"Parameters related to data that is stored during the component's interaction."}),(0,i.jsxs)("table",{children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"Parameter"}),(0,i.jsx)("th",{children:"Required"}),(0,i.jsx)("th",{children:"Default"}),(0,i.jsx)("th",{children:"Description"})]})}),(0,i.jsxs)("tbody",{children:[(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:(0,i.jsx)(n.code,{children:"storageAccountName"})}),(0,i.jsx)("td",{children:"No"}),(0,i.jsx)("td",{children:(0,i.jsx)(n.code,{children:"invictus{resourcePrefix}store"})}),(0,i.jsxs)("td",{children:["Name for the Azure Storage Account resource. Any dashes (-) will be removed from ",(0,i.jsx)(n.code,{children:"{resourcePrefix}"})]})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:(0,i.jsx)(n.code,{children:"blobContainerPrefix"})}),(0,i.jsx)("td",{children:"No"}),(0,i.jsx)("td",{children:(0,i.jsx)(n.code,{children:"invictus"})}),(0,i.jsx)("td",{children:"Prefix set for Azure Blob Storage containers for pubsub"})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:(0,i.jsx)(n.code,{children:"storageAccountType"})}),(0,i.jsx)("td",{children:"No"}),(0,i.jsx)("td",{children:(0,i.jsx)(n.code,{children:"Standard_LRS"})}),(0,i.jsxs)("td",{children:["The Storage account ",(0,i.jsx)(n.code,{children:"StorageAccountSkuType"})]})]}),(0,i.jsxs)(c.P8,{children:[(0,i.jsx)("td",{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"storageAccountSubnets"})})}),(0,i.jsx)("td",{children:(0,i.jsx)(n.strong,{children:"Yes"})}),(0,i.jsx)("td",{children:(0,i.jsx)(n.code,{children:"[]"})}),(0,i.jsx)("td",{children:(0,i.jsx)(n.strong,{children:"An array of string. The values need to match the subnet names on the VNET"})})]}),(0,i.jsxs)(c.P8,{children:[(0,i.jsx)("td",{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"disableStorageAccountPublicNetworkAccess"})})}),(0,i.jsx)("td",{children:(0,i.jsx)(n.strong,{children:"No"})}),(0,i.jsx)("td",{children:(0,i.jsx)(n.code,{children:"false"})}),(0,i.jsx)("td",{children:(0,i.jsx)(n.strong,{children:"If true, the Azure storage account used throughout Invictus will not be accessible from a public network."})})]}),(0,i.jsxs)(c.P8,{children:[(0,i.jsx)("td",{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"storageAccountMinimumTLSVersion"})})}),(0,i.jsx)("td",{children:(0,i.jsx)(n.strong,{children:"No"})}),(0,i.jsx)("td",{children:(0,i.jsx)(n.code,{children:"TLS1_2"})}),(0,i.jsx)("td",{children:(0,i.jsxs)(n.strong,{children:["Set the required TLS value for the Azure storage account. Accepted values: ",(0,i.jsx)(n.code,{children:"TLS1_0"}),", ",(0,i.jsx)(n.code,{children:"TLS1_1"}),", ",(0,i.jsx)(n.code,{children:"TLS1_2"})]})})]})]})]})]}),(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{children:"Messaging parameters"}),(0,i.jsx)(n.p,{children:"Parameters related to the messaging components, like PubSub."}),(0,i.jsxs)("table",{children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"Parameter"}),(0,i.jsx)("th",{children:"Required"}),(0,i.jsx)("th",{children:"Default"}),(0,i.jsx)("th",{children:"Description"})]})}),(0,i.jsxs)("tbody",{children:[(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:(0,i.jsx)(n.code,{children:"serviceBusNamespaceName"})}),(0,i.jsx)("td",{children:"No"}),(0,i.jsx)("td",{children:(0,i.jsx)(n.code,{children:"invictus-{resourcePrefix}-sbs"})}),(0,i.jsx)("td",{children:"Name for the Service Bus Namespace resource"})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:(0,i.jsx)(n.code,{children:"serviceBusSkuName"})}),(0,i.jsx)("td",{children:"No"}),(0,i.jsxs)("td",{children:[(0,i.jsx)(n.code,{children:"Standard"})," or ",(0,i.jsx)(n.code,{children:"Premium"})," if VNET enabled"]}),(0,i.jsx)("td",{children:"Name for the Service Bus SKU"})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:(0,i.jsx)(n.code,{children:"serviceBusMessageTimeToLiveMinutes"})}),(0,i.jsx)("td",{children:"No"}),(0,i.jsx)("td",{children:(0,i.jsx)(n.code,{children:"-1"})}),(0,i.jsx)("td",{children:"Time messages should be stored on Service Bus before being archived"})]}),(0,i.jsxs)(c.P8,{children:[(0,i.jsx)("td",{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"serviceBusSubnets"})})}),(0,i.jsx)("td",{children:(0,i.jsx)(n.strong,{children:"Yes"})}),(0,i.jsx)("td",{children:(0,i.jsx)(n.code,{children:"[]"})}),(0,i.jsx)("td",{children:(0,i.jsx)(n.strong,{children:"An array of string. The values need to match the subnet names on the VNET"})})]})]})]})]}),(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{children:"Secret parameters"}),(0,i.jsx)(n.p,{children:"Parameters related to the security and secret management of the deployed applications."}),(0,i.jsxs)("table",{children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"Parameter"}),(0,i.jsx)("th",{children:"Required"}),(0,i.jsx)("th",{children:"Default"}),(0,i.jsx)("th",{children:"Description"})]})}),(0,i.jsxs)("tbody",{children:[(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:(0,i.jsx)(n.code,{children:"keyVaultName"})}),(0,i.jsx)("td",{children:"No"}),(0,i.jsx)("td",{children:(0,i.jsx)(n.code,{children:"invictus-{resourcePrefix}-vlt"})}),(0,i.jsx)("td",{children:"Name for the Key Vault Service Namespace resource"})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:(0,i.jsx)(n.code,{children:"keyVaultEnablePurgeProtection"})}),(0,i.jsx)("td",{children:"No"}),(0,i.jsx)("td",{children:(0,i.jsx)(n.code,{children:"null"})}),(0,i.jsx)("td",{children:"If true, enables key vault purge protection. Once enabled, this property can never be disabled."})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:(0,i.jsx)(n.code,{children:"identityProviderClientSecret"})}),(0,i.jsx)("td",{children:"Yes"}),(0,i.jsx)("td",{}),(0,i.jsx)("td",{children:"AAD App Registration client secret required for Azure Container Apps Identity Provider authentication"})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:(0,i.jsx)(n.code,{children:"identityProviderApplicationId"})}),(0,i.jsx)("td",{children:"Yes"}),(0,i.jsx)("td",{}),(0,i.jsx)("td",{children:"AAD Application ID for MSI Authentication of Azure Container Apps"})]}),(0,i.jsxs)(c.P8,{children:[(0,i.jsx)("td",{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"keyVaultSubnets"})})}),(0,i.jsx)("td",{children:(0,i.jsx)(n.strong,{children:"Yes"})}),(0,i.jsx)("td",{children:(0,i.jsx)(n.code,{children:"[]"})}),(0,i.jsx)("td",{children:(0,i.jsx)(n.strong,{children:"An array of string. The values need to match the subnet names on the VNET"})})]})]})]})]}),(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{children:"Observability parameters"}),(0,i.jsx)(n.p,{children:"Parameters related to telemetry tracking of the deployed applications."}),(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{style:{textAlign:"center"},children:"Required"}),(0,i.jsx)(n.th,{children:"Default"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"appInsightsName"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"No"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"invictus-{resourcePrefix}-appins"})}),(0,i.jsx)(n.td,{children:"Name for the Application Insights resource"})]})})]})]}),(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{children:(0,i.jsx)("span",{id:"scaling-parameters",children:"Scaling parameters"})}),(0,i.jsx)(n.p,{children:"Azure Container Apps allow for flexible scaling customization. In Invictus we have provided default scaling values which can be customized according to your scenario."}),(0,i.jsx)(n.p,{children:"Container Apps have the ability to scale down to zero replicas. This is a great cost-saving option especially for components which are not used at all. A Container App scaled to zero will automatically scale out when triggered, however this may take up to a few minutes to complete. This could prove to be an issue in scenarios with limited timeout e.g. logic apps with 120 seconds timeout. In such cases there is no option but to set a minimum replica count of 1."}),(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{style:{textAlign:"center"},children:"Required"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"timeSequencerScaling"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"No"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"exceptionHandlerScaling"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"No"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"pubSubV2Scaling"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"No"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"regexTranslatorScaling"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"No"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"sequenceControllerScaling"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"No"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"transcoV2Scaling"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"No"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"xmlJsonConverterScaling"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"No"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"xsdValidatorScaling"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"No"})]})]})]}),(0,i.jsx)(n.p,{children:"Each of the above parameters accepts an object:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:'-xsdValidatorScaling @{cpuResources="0.5";memoryResources="1.0Gi";scaleMaxReplicas=1;scaleMinReplicas=0;concurrentRequests=10}\n'})}),(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter value"}),(0,i.jsx)(n.th,{style:{textAlign:"center"},children:"Type"}),(0,i.jsx)(n.th,{style:{textAlign:"center"},children:"Default"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"cpuResources"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:(0,i.jsx)(n.code,{children:"string"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:(0,i.jsx)(n.code,{children:"0.5"})}),(0,i.jsxs)(n.td,{children:["The amount of cpu resources to dedicate for the container resource. ",(0,i.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/container-apps/containers#allocations",children:"See here for allowed values"}),"."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"memoryResources"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:(0,i.jsx)(n.code,{children:"string"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:(0,i.jsx)(n.code,{children:"1.0Gi"})}),(0,i.jsxs)(n.td,{children:["The amount of memory resources to dedicate for the container resource. ",(0,i.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/container-apps/containers#allocations",children:"See here for allowed values"}),"."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"scaleMinReplicas"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:(0,i.jsx)(n.code,{children:"int"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:(0,i.jsx)(n.code,{children:"0"})}),(0,i.jsx)(n.td,{children:"The lowest number of replicas the Container App will scale in to."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"scaleMaxReplicas"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:(0,i.jsx)(n.code,{children:"int"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:(0,i.jsx)(n.code,{children:"1"})}),(0,i.jsx)(n.td,{children:"The highest number of replicas the Container App will scale out to."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"concurrentRequests"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:(0,i.jsx)(n.code,{children:"int"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:(0,i.jsx)(n.code,{children:"10"})}),(0,i.jsxs)(n.td,{children:["When the number of HTTP requests exceeds this value, then another replica is added. Replicas continue to add to the pool up to the maxReplicas amount. ",(0,i.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/container-apps/scale-app?pivots=container-apps-bicep",children:"See here fore allowed values"}),"."]})]})]})]}),(0,i.jsxs)(n.admonition,{type:"warning",children:[(0,i.jsxs)(n.mdxAdmonitionTitle,{children:["careful with ",(0,i.jsx)(n.code,{children:"scaleMinReplicas"})]}),(0,i.jsxs)(n.p,{children:["When the ",(0,i.jsx)(n.code,{children:"scaleMinReplicas"})," is set to a greater number than zero, then the amount of replicas and costs can increase rapidly when older replicas are not disposed of in time. Use with care.\n",(0,i.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:r(2049).A+"",children:"We provide a clean-up script"})," that should be run in those cases after logging in on the correct subscription, but can be ran in Azure DevOps Pipelines as well."]})]})]})]})]})]})]})}function x(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>c,x:()=>l});var t=r(6540);const i={},s=t.createContext(i);function c(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);